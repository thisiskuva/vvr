<html>
    <head>
        <title>VVR Test</title>
        <link rel='stylesheet' href='style.css'/>
    </head>
    <body>
        <div class='container'>
            <div class='cta'>Click</div>
        <div>
        <canvas id='video'></canvas>

        <script src="index.js"></script>

        <script>

            /*
                Util for returning query string paramaters
            */

            function urlparam( name ){

                name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
                var results = new RegExp( "[\\?&]"+name+"=([^&#]*)" ).exec( window.location.href );
                return results ? results[1] : null
            }


            /*
                Use any pano defined on the query string, otherwise use a default
            */
            var url = urlparam( 'url' ) || 'VR_Test_Cubemap_044.jpg'
            console.log( 'Loading panorama:', url )


            /*
                Determine the whether an image or a video
            */
            var isImage = (/\.(jpg|jpeg|png)$/i).test( url )


            /*
                Fetch the canvas element, select an appropritate viewer,
                and initialise the panorama
            */
            var canvas = document.querySelector( 'canvas' )
            var Viewer = isImage ? pano.image : pano.video
            var player = Viewer( canvas, url )


            /*
                Create a resize method that defaults to the page dimension
            */
            var resize = function(){
                player.setSize( window.innerWidth, window.innerHeight )
            }

            window.addEventListener( 'resize', resize )
            resize()



            /*
                If we're rendering an video panorama, then we need to start
                playing it. If not, then disable the CTA
            */

            if( isImage ){

                document.querySelector('.cta').style.display = 'none'

            }else{
                player.toggleMute()
                window.onclick = function(){
                    window.onclick = null
                    document.querySelector('.cta').style.display = 'none'
                    player.play()
                }
            }

            window.player = player


        </script>
    </body>
<html>
